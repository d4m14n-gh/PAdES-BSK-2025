<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BSK Project Doxygen documentation: C:/Users/macie/OneDrive/Pulpit/informatyka/BSK/PAdES-BSK-2025/GeneratorAESsrc/main.js</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BSK Project Doxygen documentation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('_c_1_2_users_2macie_2_one_drive_2_pulpit_2informatyka_2_b_s_k_2_p_ad_e_s-_b_s_k-2025_2_generator_a_e_ssrc_2main_8js-example.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">C:/Users/macie/OneDrive/Pulpit/informatyka/BSK/PAdES-BSK-2025/GeneratorAESsrc/main.js</div></div>
</div><!--header-->
<div class="contents">
<p>Generates an RSA key pair, encrypts the private key, and saves the keys to disk.</p>
<p>This function creates a 4096-bit RSA key pair, encrypts the private key using a user-provided PIN, and saves both the public and encrypted private keys as files on the specified disk path.</p>
<p>@function </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{string}</td><td>diskPath - The directory path where the RSA key files will be saved. Must be a valid and writable directory path. </td></tr>
    <tr><td class="paramname">{string}</td><td>userPIN - A PIN provided by the user to encrypt the private key. Must be a non-empty string. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>{Promise&lt;Object&gt;} A promise that resolves to an object containing:<ul>
<li><span class="tt">publicKeyPath</span> (string): The file path of the saved public key.</li>
<li><span class="tt">privateKeyPath</span> (string): The file path of the saved encrypted private key. </li>
</ul>
</dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">{Error}</td><td>If key generation, encryption, or file writing fails.</td></tr>
  </table>
  </dd>
</dl>
<p>const diskPath = '/path/to/keys'; const userPIN = '1234';</p>
<p>generateRSAKeys(diskPath, userPIN) .then(({ publicKeyPath, privateKeyPath }) =&gt; { console.log('Keys generated successfully:'); console.log('Public Key:', publicKeyPath); console.log('Encrypted Private Key:', privateKeyPath); }) .catch((error) =&gt; { console.error('Failed to generate keys:', error.message); });</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> {BrowserWindow, app, ipcMain} = require(<span class="stringliteral">&#39;electron&#39;</span>)<span class="keyword"></span></div>
<div class="line"><span class="keyword">const </span>{exec} = require(<span class="stringliteral">&#39;child_process&#39;</span>);</div>
<div class="line"><span class="keyword">const</span> <a id="_a0" name="_a0"></a><a class="code hl_variable" href="_generator_a_e_ssrc_2main_8js.html#a1fdc7709faf62dce60620fb3f9d3453c">path</a> = require(<span class="stringliteral">&#39;path&#39;</span>);</div>
<div class="line"><span class="keyword">const</span> <a id="_a1" name="_a1"></a><a class="code hl_variable" href="_generator_a_e_ssrc_2main_8js.html#a2e47e1f004220675d0fa39b8255bd78f">fs</a> = require(<span class="stringliteral">&#39;fs&#39;</span>);</div>
<div class="line"><span class="keyword">const</span> <a id="_a2" name="_a2"></a><a class="code hl_variable" href="_generator_a_e_ssrc_2main_8js.html#a607091759c690210419aa15f07f84b9f">forge</a> = require(<span class="stringliteral">&#39;node-forge&#39;</span>);</div>
<div class="line"><span class="keyword">const</span> <a id="_a3" name="_a3"></a><a class="code hl_variable" href="_generator_a_e_ssrc_2main_8js.html#a44d29f599486b46f8b3f74e5ff5e8b94">crypto</a> =require(<span class="stringliteral">&#39;crypto&#39;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <a id="_a4" name="_a4"></a><a class="code hl_variable" href="_generator_a_e_ssrc_2main_8js.html#afd68f54fec210ddd90d8fb51baff9e85">createWindow</a> = ()=&gt;{</div>
<div class="line">    <span class="keyword">const</span> win = <span class="keyword">new</span> BrowserWindow({</div>
<div class="line">        width:800,</div>
<div class="line">        height:600, </div>
<div class="line">        webPreferences:{</div>
<div class="line">            preload: <a class="code hl_variable" href="_generator_a_e_ssrc_2main_8js.html#a1fdc7709faf62dce60620fb3f9d3453c">path</a>.join(__dirname, <span class="stringliteral">&#39;preload.js&#39;</span>)</div>
<div class="line">        }</div>
<div class="line">    })</div>
<div class="line">    win.loadFile(<span class="stringliteral">&quot;index.html&quot;</span>)</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">app.whenReady().then(()=&gt;{</div>
<div class="line">    <a class="code hl_variable" href="_generator_a_e_ssrc_2main_8js.html#afd68f54fec210ddd90d8fb51baff9e85">createWindow</a>();</div>
<div class="line">});</div>
<div class="line"></div>
<div class="line"><span class="keyword">function</span> <a id="a5" name="a5"></a><a class="code hl_function" href="_generator_a_e_ssrc_2main_8js.html#a31546c094c42184a86101814f12f6276">getAvailableDrives</a>() {</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">new</span> Promise((resolve, reject) =&gt; {</div>
<div class="line">        exec(<span class="stringliteral">&#39;wmic logicaldisk get name&#39;</span>, (error, stdout) =&gt; {</div>
<div class="line">            <span class="keywordflow">if</span> (error) {</div>
<div class="line">                reject(error);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keyword">const</span> drives = stdout</div>
<div class="line">                    .split(<span class="charliteral">&#39;\n&#39;</span>)</div>
<div class="line">                    .filter((line) =&gt; line.includes(<span class="charliteral">&#39;:&#39;</span>))</div>
<div class="line">                    .map((drive) =&gt; drive.trim());</div>
<div class="line">                resolve(drives);</div>
<div class="line">            }</div>
<div class="line">        });</div>
<div class="line">    });</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">function</span> <a id="a6" name="a6"></a><a class="code hl_function" href="_generator_a_e_ssrc_2main_8js.html#a5880286a97e6ffca2d935d98ca1356f4">generateRSAKeys</a>(diskPath, userPIN) {</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">new</span> Promise((resolve, reject) =&gt; {</div>
<div class="line">        <span class="keywordflow">try</span> {</div>
<div class="line">            console.log(<span class="stringliteral">&#39;generateRSAKeys called with:&#39;</span>, { diskPath, userPIN });</div>
<div class="line">            <span class="keyword">const</span> keypair = <a class="code hl_variable" href="_generator_a_e_ssrc_2main_8js.html#a607091759c690210419aa15f07f84b9f">forge</a>.pki.rsa.generateKeyPair({ bits: 4096 });</div>
<div class="line">            <span class="keyword">const</span> publicKeyPem = <a class="code hl_variable" href="_generator_a_e_ssrc_2main_8js.html#a607091759c690210419aa15f07f84b9f">forge</a>.pki.publicKeyToPem(keypair.publicKey);</div>
<div class="line">            <span class="keyword">const</span> privateKeyPem = <a class="code hl_variable" href="_generator_a_e_ssrc_2main_8js.html#a607091759c690210419aa15f07f84b9f">forge</a>.pki.privateKeyToPem(keypair.privateKey);</div>
<div class="line">            </div>
<div class="line">            <span class="keyword">const</span> aesKey = <a id="a7" name="a7"></a><a class="code hl_function" href="_generator_a_e_ssrc_2main_8js.html#a52190aae589c870c686f4f93cf41eb1d">hashPIN</a>(userPIN);</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> encrypted = <a id="a8" name="a8"></a><a class="code hl_function" href="_generator_a_e_ssrc_2main_8js.html#aceec6da763423b4745e8f1485d699d45">encryptWithAES</a>(privateKeyPem, aesKey);</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> publicKeyPath = <a class="code hl_variable" href="_generator_a_e_ssrc_2main_8js.html#a1fdc7709faf62dce60620fb3f9d3453c">path</a>.join(diskPath, <span class="stringliteral">&#39;rsa_public_key.pem&#39;</span>);</div>
<div class="line">            <span class="keyword">const</span> privateKeyPath = <a class="code hl_variable" href="_generator_a_e_ssrc_2main_8js.html#a1fdc7709faf62dce60620fb3f9d3453c">path</a>.join(diskPath, <span class="stringliteral">&#39;rsa_private_key.pem&#39;</span>);</div>
<div class="line"> </div>
<div class="line">            <a class="code hl_variable" href="_generator_a_e_ssrc_2main_8js.html#a2e47e1f004220675d0fa39b8255bd78f">fs</a>.writeFileSync(publicKeyPath, publicKeyPem);</div>
<div class="line">            console.log(<span class="stringliteral">&quot;Type of encrypted&quot;</span>, typeof data)</div>
<div class="line">            <span class="keywordflow">if</span> (!Buffer.isBuffer(encrypted)) {</div>
<div class="line">                <span class="keywordflow">throw</span> <span class="keyword">new</span> Error(<span class="stringliteral">&#39;Encryption failed. &quot;encrypted&quot; is not a Buffer.&#39;</span>);</div>
<div class="line">            }</div>
<div class="line">            <a class="code hl_variable" href="_generator_a_e_ssrc_2main_8js.html#a2e47e1f004220675d0fa39b8255bd78f">fs</a>.writeFileSync(privateKeyPath, encrypted);</div>
<div class="line"> </div>
<div class="line">            resolve({ publicKeyPath, privateKeyPath });</div>
<div class="line">        } <span class="keywordflow">catch</span> (error) {</div>
<div class="line">            reject(error);</div>
<div class="line">        }</div>
<div class="line">    });</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">function</span> <a class="code hl_function" href="_generator_a_e_ssrc_2main_8js.html#a52190aae589c870c686f4f93cf41eb1d">hashPIN</a>(pin) {</div>
<div class="line">    console.log(<span class="stringliteral">&#39;hashPIN called with:&#39;</span>, pin);</div>
<div class="line">    <span class="keywordflow">if</span> (!pin || typeof pin !== <span class="stringliteral">&#39;string&#39;</span>) {</div>
<div class="line">        <span class="keywordflow">throw</span> <span class="keyword">new</span> Error(<span class="stringliteral">&#39;Invalid PIN. Expected a non-empty string.&#39;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_variable" href="_generator_a_e_ssrc_2main_8js.html#a44d29f599486b46f8b3f74e5ff5e8b94">crypto</a>.createHash(<span class="stringliteral">&#39;sha256&#39;</span>).update(pin, <span class="stringliteral">&#39;utf8&#39;</span>).digest();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">function</span> <a class="code hl_function" href="_generator_a_e_ssrc_2main_8js.html#aceec6da763423b4745e8f1485d699d45">encryptWithAES</a>(data, aesKey) {</div>
<div class="line">    console.log(<span class="stringliteral">&#39;Type of data:&#39;</span>, typeof data);</div>
<div class="line">    console.log(<span class="stringliteral">&#39;Type of aesKey:&#39;</span>, typeof aesKey);</div>
<div class="line">    <span class="keywordflow">if</span> (!aesKey || aesKey.length !== 32) { </div>
<div class="line">        <span class="keywordflow">throw</span> <span class="keyword">new</span> Error(<span class="stringliteral">&#39;Invalid AES key. Expected a 256-bit key.&#39;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">const</span> cipher = <a class="code hl_variable" href="_generator_a_e_ssrc_2main_8js.html#a44d29f599486b46f8b3f74e5ff5e8b94">crypto</a>.createCipheriv(<span class="stringliteral">&#39;aes-256-ecb&#39;</span>, aesKey, <span class="keyword">null</span>); </div>
<div class="line">    cipher.setAutoPadding(<span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        <span class="keyword">const</span> encrypted = Buffer.concat([cipher.update(data, <span class="stringliteral">&#39;utf8&#39;</span>), cipher.final()]);</div>
<div class="line">        console.log(<span class="stringliteral">&#39;Type of encrypted:&#39;</span>, typeof encrypted);</div>
<div class="line">        <span class="keywordflow">if</span> (!Buffer.isBuffer(encrypted)) {</div>
<div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> Error(<span class="stringliteral">&#39;Encryption failed. &quot;encrypted&quot; is not a Buffer.&#39;</span>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> encrypted;</div>
<div class="line">    } <span class="keywordflow">catch</span> (error) {</div>
<div class="line">        console.error(<span class="stringliteral">&#39;Encryption error:&#39;</span>, error);</div>
<div class="line">        <span class="keywordflow">throw</span> error;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">ipcMain.handle(<span class="stringliteral">&#39;get-drives&#39;</span>, async () =&gt; {</div>
<div class="line">    <span class="keyword">const</span> drives = await <a class="code hl_function" href="_generator_a_e_ssrc_2main_8js.html#a31546c094c42184a86101814f12f6276">getAvailableDrives</a>();</div>
<div class="line">    <span class="keywordflow">return</span> drives;</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">ipcMain.handle(<span class="stringliteral">&#39;generate-keys&#39;</span>, async (_, diskPath, userPIN) =&gt; {</div>
<div class="line">    <span class="keywordflow">return</span> await <a class="code hl_function" href="_generator_a_e_ssrc_2main_8js.html#a5880286a97e6ffca2d935d98ca1356f4">generateRSAKeys</a>(diskPath, userPIN);</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">app.on(<span class="stringliteral">&#39;window-all-closed&#39;</span>, () =&gt; {</div>
<div class="line">    <span class="keywordflow">if</span> (process.platform !== <span class="stringliteral">&#39;darwin&#39;</span>) {</div>
<div class="line">        app.quit();</div>
<div class="line">    }</div>
<div class="line">});</div>
<div class="ttc" id="a_generator_a_e_ssrc_2main_8js_html_a1fdc7709faf62dce60620fb3f9d3453c"><div class="ttname"><a href="_generator_a_e_ssrc_2main_8js.html#a1fdc7709faf62dce60620fb3f9d3453c">path</a></div><div class="ttdeci">const path</div><div class="ttdef"><b>Definition</b> GeneratorAESsrc/main.js:3</div></div>
<div class="ttc" id="a_generator_a_e_ssrc_2main_8js_html_a2e47e1f004220675d0fa39b8255bd78f"><div class="ttname"><a href="_generator_a_e_ssrc_2main_8js.html#a2e47e1f004220675d0fa39b8255bd78f">fs</a></div><div class="ttdeci">const fs</div><div class="ttdef"><b>Definition</b> GeneratorAESsrc/main.js:4</div></div>
<div class="ttc" id="a_generator_a_e_ssrc_2main_8js_html_a31546c094c42184a86101814f12f6276"><div class="ttname"><a href="_generator_a_e_ssrc_2main_8js.html#a31546c094c42184a86101814f12f6276">getAvailableDrives</a></div><div class="ttdeci">function getAvailableDrives()</div><div class="ttdef"><b>Definition</b> GeneratorAESsrc/main.js:35</div></div>
<div class="ttc" id="a_generator_a_e_ssrc_2main_8js_html_a44d29f599486b46f8b3f74e5ff5e8b94"><div class="ttname"><a href="_generator_a_e_ssrc_2main_8js.html#a44d29f599486b46f8b3f74e5ff5e8b94">crypto</a></div><div class="ttdeci">const crypto</div><div class="ttdef"><b>Definition</b> GeneratorAESsrc/main.js:6</div></div>
<div class="ttc" id="a_generator_a_e_ssrc_2main_8js_html_a52190aae589c870c686f4f93cf41eb1d"><div class="ttname"><a href="_generator_a_e_ssrc_2main_8js.html#a52190aae589c870c686f4f93cf41eb1d">hashPIN</a></div><div class="ttdeci">function hashPIN(pin)</div><div class="ttdef"><b>Definition</b> GeneratorAESsrc/main.js:121</div></div>
<div class="ttc" id="a_generator_a_e_ssrc_2main_8js_html_a5880286a97e6ffca2d935d98ca1356f4"><div class="ttname"><a href="_generator_a_e_ssrc_2main_8js.html#a5880286a97e6ffca2d935d98ca1356f4">generateRSAKeys</a></div><div class="ttdeci">function generateRSAKeys(diskPath, userPIN)</div><div class="ttdef"><b>Definition</b> GeneratorAESsrc/main.js:81</div></div>
<div class="ttc" id="a_generator_a_e_ssrc_2main_8js_html_a607091759c690210419aa15f07f84b9f"><div class="ttname"><a href="_generator_a_e_ssrc_2main_8js.html#a607091759c690210419aa15f07f84b9f">forge</a></div><div class="ttdeci">const forge</div><div class="ttdef"><b>Definition</b> GeneratorAESsrc/main.js:5</div></div>
<div class="ttc" id="a_generator_a_e_ssrc_2main_8js_html_aceec6da763423b4745e8f1485d699d45"><div class="ttname"><a href="_generator_a_e_ssrc_2main_8js.html#aceec6da763423b4745e8f1485d699d45">encryptWithAES</a></div><div class="ttdeci">function encryptWithAES(data, aesKey)</div><div class="ttdef"><b>Definition</b> GeneratorAESsrc/main.js:158</div></div>
<div class="ttc" id="a_generator_a_e_ssrc_2main_8js_html_afd68f54fec210ddd90d8fb51baff9e85"><div class="ttname"><a href="_generator_a_e_ssrc_2main_8js.html#afd68f54fec210ddd90d8fb51baff9e85">createWindow</a></div><div class="ttdeci">const createWindow</div><div class="ttdef"><b>Definition</b> GeneratorAESsrc/main.js:8</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
